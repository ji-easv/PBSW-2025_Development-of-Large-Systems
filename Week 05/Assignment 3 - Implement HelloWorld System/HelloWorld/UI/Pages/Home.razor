@page "/"
@inject HttpClient Http
@inject IJSRuntime JS

<h3>Select a Language</h3>

<!-- Dropdown to select a language -->
<select @onchange="OnLanguageChanged" class="form-control">
    <option value="">Select a language</option>
    @foreach (var language in languages)
    {
        <option value="@language">@language</option>
    }
</select>

@if (!string.IsNullOrEmpty(selectedLanguage))
{
    <p><strong>Greeting:</strong> @greeting</p>
    <p><strong>Planet:</strong> @planet</p>
}

@code {
    private List<string> languages = [];
    private string selectedLanguage;
    private string greeting;
    private string planet;

    protected override async Task OnInitializedAsync()
    {
        try {
            // Get the list of languages from the API
            languages = await Http.GetFromJsonAsync<List<string>>("http://localhost:5000/language/list") ?? ["en"];
        } catch (Exception ex) {
            Console.WriteLine(ex.Message);
        }
        // Get the list of languages from the API
        // languages = await Http.GetFromJsonAsync<List<string>>("http://localhost:5000/languages") ?? ["en"];
    }

    private async Task OnLanguageChanged(ChangeEventArgs e)
    {
        selectedLanguage = e.Value.ToString();

        if (!string.IsNullOrEmpty(selectedLanguage))
        {
            // Call the GetGreeting endpoint
            greeting = await Http.GetStringAsync($"http://localhost:5000/greeting?language={selectedLanguage}");

            // Call the GetPlanet endpoint
            planet = await Http.GetStringAsync($"http://localhost:5000/planet?language={selectedLanguage}");
        }
    }
}